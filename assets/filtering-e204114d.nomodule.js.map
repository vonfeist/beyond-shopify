{"version":3,"file":"filtering-e204114d.nomodule.js","sources":["../../src/scripts/lib/filters/filtering.js"],"sourcesContent":["import { qsa } from '@fluorescent/dom';\n\nimport { emit } from '@/glow/events';\n\nconst filtering = container => {\n  const forms = qsa('[data-filter-form]', container);\n  let formData, searchParams;\n  setParams();\n\n  function setParams(form) {\n    form = form || forms[0];\n    formData = new FormData(form);\n    searchParams = new URLSearchParams(formData).toString();\n  }\n\n  /**\n   * Takes the updated form element and updates all other forms with the updated values\n   * @param {*} target\n   */\n  function syncForms(target) {\n    if (!target) return;\n\n    const targetInputs = qsa('[data-filter-item]', target);\n\n    targetInputs.forEach(targetInput => {\n      if (targetInput.type === 'checkbox' || targetInput.type === 'radio') {\n        const items = qsa(\n          `input[name='${targetInput.name}'][value='${targetInput.value}']`\n        );\n        items.forEach(input => {\n          input.checked = targetInput.checked;\n        });\n      } else {\n        const items = qsa(`input[name='${targetInput.name}']`);\n        items.forEach(input => {\n          input.value = targetInput.value;\n        });\n      }\n    });\n  }\n\n  /**\n   * When filters are removed, set the checked attribute to false\n   * for all filter inputs for that filter.\n   * Can accept multiple filters\n   * @param {Array} targets Array of inputs\n   */\n  function uncheckFilters(targets) {\n    if (!targets) return;\n\n    let selector;\n\n    targets.forEach(target => {\n      selector = !selector ? '' : `, ${selector}`;\n      const { name, value } = target.dataset;\n      selector = `input[name='${name}'][value='${value}']${selector}`;\n    });\n\n    const inputs = qsa(selector, container);\n\n    inputs.forEach(input => {\n      input.checked = false;\n    });\n  }\n\n  function clearRangeInputs() {\n    const rangeInputs = qsa('[data-range-input]', container);\n    rangeInputs.forEach(input => {\n      input.value = '';\n    });\n  }\n\n  function resetForms() {\n    forms.forEach(form => {\n      form.reset();\n    });\n  }\n\n  return {\n    getState() {\n      return {\n        url: searchParams,\n      };\n    },\n\n    filtersUpdated(target, cb) {\n      syncForms(target);\n      setParams(target);\n      emit('filters:updated');\n      return cb(this.getState());\n    },\n\n    removeFilters(target, cb) {\n      uncheckFilters(target);\n      setParams();\n      emit('filters:filter-removed');\n      return cb(this.getState());\n    },\n\n    removeRange(cb) {\n      clearRangeInputs();\n      setParams();\n      emit('filters:range-removed');\n      return cb(this.getState());\n    },\n\n    clearAll(cb) {\n      searchParams = '';\n      resetForms();\n\n      return cb(this.getState());\n    },\n  };\n};\n\nexport default filtering;\n"],"names":["filtering","container","forms","qsa","formData","searchParams","setParams","form","FormData","URLSearchParams","toString","syncForms","target","targetInputs","forEach","targetInput","type","items","name","value","input","checked","uncheckFilters","targets","selector","dataset","inputs","clearRangeInputs","rangeInputs","resetForms","reset","getState","url","filtersUpdated","cb","emit","removeFilters","removeRange","clearAll"],"mappings":";;;;;;;;;;YAIMA,SAAS,sBAAGC,SAAS,IAAI;MAC7B,QAAMC,KAAK,GAAGC,CAAG,CAAC,oBAAD,EAAuBF,SAAvB,CAAjB;MACA,MAAIG,QAAJ,EAAcC,YAAd;MACAC,EAAAA,SAAS;;MAET,WAASA,SAAT,CAAmBC,IAAnB,EAAyB;MACvBA,IAAAA,IAAI,GAAGA,IAAI,IAAIL,KAAK,CAAC,CAAD,CAApB;MACAE,IAAAA,QAAQ,GAAG,IAAII,QAAJ,CAAaD,IAAb,CAAX;MACAF,IAAAA,YAAY,GAAG,IAAII,eAAJ,CAAoBL,QAApB,EAA8BM,QAA9B,EAAf;MACD;MAED;MACF;MACA;MACA;;;MACE,WAASC,SAAT,CAAmBC,MAAnB,EAA2B;MACzB,QAAI,CAACA,MAAL,EAAa;MAEb,UAAMC,YAAY,GAAGV,CAAG,CAAC,oBAAD,EAAuBS,MAAvB,CAAxB;MAEAC,IAAAA,YAAY,CAACC,OAAb,CAAqBC,WAAW,IAAI;MAClC,UAAIA,WAAW,CAACC,IAAZ,KAAqB,UAArB,IAAmCD,WAAW,CAACC,IAAZ,KAAqB,OAA5D,EAAqE;MACnE,cAAMC,KAAK,GAAGd,CAAG,CACd,eAAcY,WAAW,CAACG,IAAK,aAAYH,WAAW,CAACI,KAAM,IAD/C,CAAjB;MAGAF,QAAAA,KAAK,CAACH,OAAN,CAAcM,KAAK,IAAI;MACrBA,UAAAA,KAAK,CAACC,OAAN,GAAgBN,WAAW,CAACM,OAA5B;MACD,SAFD;MAGD,OAPD,MAOO;MACL,cAAMJ,KAAK,GAAGd,CAAG,CAAE,eAAcY,WAAW,CAACG,IAAK,IAAjC,CAAjB;MACAD,QAAAA,KAAK,CAACH,OAAN,CAAcM,KAAK,IAAI;MACrBA,UAAAA,KAAK,CAACD,KAAN,GAAcJ,WAAW,CAACI,KAA1B;MACD,SAFD;MAGD;MACF,KAdD;MAeD;MAED;MACF;MACA;MACA;MACA;MACA;;;MACE,WAASG,cAAT,CAAwBC,OAAxB,EAAiC;MAC/B,QAAI,CAACA,OAAL,EAAc;MAEd,QAAIC,QAAJ;MAEAD,IAAAA,OAAO,CAACT,OAAR,CAAgBF,MAAM,IAAI;MACxBY,MAAAA,QAAQ,GAAG,CAACA,QAAD,GAAY,EAAZ,GAAkB,KAAIA,QAAS,EAA1C;MACA,YAAM;MAAEN,QAAAA,IAAF;MAAQC,QAAAA;MAAR,UAAkBP,MAAM,CAACa,OAA/B;MACAD,MAAAA,QAAQ,GAAI,eAAcN,IAAK,aAAYC,KAAM,KAAIK,QAAS,EAA9D;MACD,KAJD;MAMA,UAAME,MAAM,GAAGvB,CAAG,CAACqB,QAAD,EAAWvB,SAAX,CAAlB;MAEAyB,IAAAA,MAAM,CAACZ,OAAP,CAAeM,KAAK,IAAI;MACtBA,MAAAA,KAAK,CAACC,OAAN,GAAgB,KAAhB;MACD,KAFD;MAGD;;MAED,WAASM,gBAAT,GAA4B;MAC1B,UAAMC,WAAW,GAAGzB,CAAG,CAAC,oBAAD,EAAuBF,SAAvB,CAAvB;MACA2B,IAAAA,WAAW,CAACd,OAAZ,CAAoBM,KAAK,IAAI;MAC3BA,MAAAA,KAAK,CAACD,KAAN,GAAc,EAAd;MACD,KAFD;MAGD;;MAED,WAASU,UAAT,GAAsB;MACpB3B,IAAAA,KAAK,CAACY,OAAN,CAAcP,IAAI,IAAI;MACpBA,MAAAA,IAAI,CAACuB,KAAL;MACD,KAFD;MAGD;;MAED,SAAO;MACLC,IAAAA,QAAQ,GAAG;MACT,aAAO;MACLC,QAAAA,GAAG,EAAE3B;MADA,OAAP;MAGD,KALI;;MAOL4B,IAAAA,cAAc,CAACrB,MAAD,EAASsB,EAAT,EAAa;MACzBvB,MAAAA,SAAS,CAACC,MAAD,CAAT;MACAN,MAAAA,SAAS,CAACM,MAAD,CAAT;MACAuB,MAAAA,CAAI,CAAC,iBAAD,CAAJ;MACA,aAAOD,EAAE,CAAC,KAAKH,QAAL,EAAD,CAAT;MACD,KAZI;;MAcLK,IAAAA,aAAa,CAACxB,MAAD,EAASsB,EAAT,EAAa;MACxBZ,MAAAA,cAAc,CAACV,MAAD,CAAd;MACAN,MAAAA,SAAS;MACT6B,MAAAA,CAAI,CAAC,wBAAD,CAAJ;MACA,aAAOD,EAAE,CAAC,KAAKH,QAAL,EAAD,CAAT;MACD,KAnBI;;MAqBLM,IAAAA,WAAW,CAACH,EAAD,EAAK;MACdP,MAAAA,gBAAgB;MAChBrB,MAAAA,SAAS;MACT6B,MAAAA,CAAI,CAAC,uBAAD,CAAJ;MACA,aAAOD,EAAE,CAAC,KAAKH,QAAL,EAAD,CAAT;MACD,KA1BI;;MA4BLO,IAAAA,QAAQ,CAACJ,EAAD,EAAK;MACX7B,MAAAA,YAAY,GAAG,EAAf;MACAwB,MAAAA,UAAU;MAEV,aAAOK,EAAE,CAAC,KAAKH,QAAL,EAAD,CAAT;MACD;;MAjCI,GAAP;MAmCD;;;;;;;;"}